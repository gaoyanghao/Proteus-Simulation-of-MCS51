
;13.设计一个8051单片机外扩键盘和显示器电路，要求扩展8个键，4位LED显示器。

		ORG 0000H
		LJMP START
		ORG 0030H
START:	MOV SP,#60H
		MOV DPTR,#7F00H
		MOV A,#03H
		MOVX @DPTR,A
		MOV R4,#00H
ZX:		LCALL DISP8155
		LCALL KEY
		SJMP ZX
KEY:	ACALL KS1
		JNZ LK1
		ACALL DISP8155
		RET
LK1:	ACALL DISP8155
		ACALL DISP8155
		ACALL KS1
		JNZ LK2
		RET
LK2:	MOV R2,#01H
		MOV R4,#00H
LK3:	MOV DPTR,#7F02H
		MOV A,R2
		MOVX @DPTR,A
		INC DPTR
		MOVX A,@DPTR
		JB ACC.0,LONE
		MOV A,#00H
		AJMP LKP
LONE:	JB ACC.1,LTWO
		MOV A,#02H
		AJMP LKP
LTWO:	JB ACC.2,LTHR
		MOV A,#04H
		AJMP LKP
LTHR:	JB ACC.3,NEXT
		MOV A,#06H
		AJMP LKP
LKP:	ADD A,R4
		MOV R4,A
		PUSH ACC
LK4:	ACALL DISP8155
		ACALL KS1
		JNZ LK4
		POP ACC
		RET
NEXT:	INC R4
		MOV A,R2
		JB ACC.1,KND
		RL A
		MOV R2,A
		AJMP LK3
KND:	RET
KS1:	MOV DPTR,#7F02H
		MOV A,#0FFH
		MOVX @DPTR,A
		INC DPTR
		MOVX A,@DPTR
		ORL A,#0F0H
		CPL A
		RET
DISP8155:
		MOV 31H,#00H
		MOV 32H,#00H
		MOV 33H,#00H
		MOV A,R4
		MOV 30H,A
		MOV R0,#33H
		MOV R5,#04H
		MOV R1,#08H
DP2:	MOV DPTR,#7F02H
		MOV A,R1
		MOVX @DPTR,A
		MOV A,@R0
		MOV DPTR,#TAB
		MOVC A,@A+DPTR
		MOV DPTR,#7F01H
		MOVX @DPTR,A
		LCALL DELAY
		MOV A,R1
		RR A
		MOV R1,A
		DEC R0
		DJNZ R5,DP2
		RET
DELAY:	MOV R6,#0FFH
DY:		DJNZ R6,DY
		RET
DELAY1:	MOV R7,#30
DL1:	MOV R6,#200
DL2:	DJNZ R6,DL2
		DJNZ R7,DL1
		RET
TAB:	DB 0C0H,0F9H,0A4H,0B0H,99H,92H,82H,0F8H,80H,90H
		END