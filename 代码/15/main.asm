
;15.利用单片机串行口，用一片74LS164扩展3×8键盘矩阵，P1.0~P1.2作为键盘输入口。
;   试画出该部分接口逻辑电路图，并编写与之对应的按键识别程序。

		ORG 0000H
		LJMP START
		ORG 0100H
START:	MOV SCON,#00H
		MOV SP,#60H
		MOV R4,#00H
		MOV A,#0FFH
		MOV P0,A
		LCALL DISP
ST1:	MOV A,#00H
		LCALL VARTO
CHK:	JNB P0.0,CHK0
		JNB P0.1,CHK0
		JNB P0.2,CHK0
		LCALL DISP
		AJMP CHK
CHK0:	LCALL DELAY100ms
		JNB P0.0,CHEN
		JNB P0.1,CHEN
		JNB P0.2,CHEN
		LCALL DISP
		AJMP CHK
CHEN:	MOV R2,#0FEH
		MOV R4,#00H
CHKN:	MOV A,R2
		LCALL VARTO
		JB P0.0,CH1
		MOV A,#00H
		AJMP CKEY
CH1:	JB P0.1,CH2
		MOV A,#08H
		AJMP CKEY
CH2:	JB P0.2,NEXT
		MOV A,#16H
		AJMP CKEY
CKEY:	ADD A,R4
		DA A
		MOV R4,A
		LCALL DISP
		AJMP ST1
NEXT:	INC R4
		MOV A,R2
		JNB ACC.7,KEND
		RL A
		MOV R2,A
		AJMP CHKN
KEND:	AJMP ST1
VARTO:	MOV SBUF,A
		JNB TI,$
		CLR TI
		RET
DISP:	MOV A,R4
		ANL A,#0FH
		MOV 30H,A
		MOV A,R4
		ANL A,#0F0H
		SWAP A
		MOV 31H,A
		MOV R0,#31H
		MOV R5,#02H
		MOV R1,#0FDH
DP2:	MOV A,R1
		MOV P2,A
		MOV A,@R0
		MOV DPTR,#TAB
		MOVC A,@A+DPTR
		MOV P1,A
		LCALL DELAY100ms
		MOV A,R1
		RR A
		MOV R1,A
		DEC R0
		DJNZ R5,DP2
		RET
DELAY100ms:
		MOV R7,#50
DLY1:	MOV R6,#100
DLY2:	DJNZ R6,DLY2
		DJNZ R7,DLY1
		RET
TAB:	DB 3FH,06H,5BH,4FH,66H,6DH,7DH,07H,7FH,6FH
		END